import{C as Y,D as x,K as h,L as j,U as M,a as B,b as G,c as U,e as H,g as K,i as v,j as D,m as Q,n as T,q as X,sa as E,ta as k,u as C,ua as w,y}from"./chunk-Y7GHDLQ4.js";import{a as m,b as $}from"./chunk-WIVAHSHW.js";function I(e){e||(x(I),e=y(j));let r=new G(i=>e.onDestroy(i.next.bind(i)));return i=>i.pipe(X(r))}function N(e,r){!r?.injector&&x(N);let i=r?.injector??y(h),t=new H(1),n=w(()=>{let o;try{o=e()}catch(c){k(()=>t.error(c));return}k(()=>t.next(o))},{injector:i,manualCleanup:!0});return i.get(j).onDestroy(()=>{n.destroy(),t.complete()}),t.asObservable()}function z(e,r,i){!r&&x(e);let t=r??y(h);return i?Y(t,i):t}function S(e,...r){let[i,t,n,o,c]=te(r);if(i){let d=null;return n instanceof j?d=n:d=z(S,n).get(j),i.pipe(I(d)).subscribe(s=>{let f=()=>{e.update(l=>{if(!g(l))return t?.(l,s)||s;if(!g(s)){let u=t?t(l,s):s;return g(u)?m(m({},l),u):u}return m(m({},l),t?.(l,s)||s)})};o?k(f):f()})}if(c){let d=n instanceof h?z(S,n):void 0;return w(()=>{e.update(s=>g(s)?m(m({},s),c()):c())},{allowSignalWrites:!0,injector:d})}return{with(...d){if(!this.subscription)this.subscription=new B;else if(this.subscription.closed)return console.info("[ngxtension connect] ConnectedSignal has been closed."),this;return this.subscription.add(S(e,...d,n,o)),this},subscription:null}}function te(e){return e.length>3?[e[0],e[1],e[2],e[3],null]:e.length===3?typeof e[2]=="boolean"?v(e[0])?[e[0],null,e[1],e[2],null]:[null,null,e[1],e[2],e[0]]:[e[0],e[1],e[2],!1,null]:e.length===2?typeof e[1]=="boolean"?[null,null,e[0],e[1],null]:typeof e[1]=="function"?[e[0],e[1],null,!1,null]:[e[0],null,e[1],!1,null]:v(e[0])?[e[0],null,null,!1,null]:typeof e[0]=="function"?[null,null,null,!1,e[0]]:[null,null,e[0],!1,null]}function g(e){return typeof e=="object"&&e!==void 0&&e!==null&&!Array.isArray(e)}function _(e){let r=y(j),i=y(h),{initialState:t,sources:n=[],lazySources:o=[],actionSources:c={},selectors:d=()=>({}),effects:s=()=>({}),actionEffects:f=()=>({})}=e,l=M(t),u=l.asReadonly(),A=N(l),J=!1,P=[],O=u;Z(l,n);for(let[a,p]of Object.entries(c)){let b=new U;if(P.push(b),v(p))V(u,A,a,r,p,P,b);else{let R=new U,W=p(u,R).pipe(T());S(l,W),V(u,A,a,r,R,P,b,W)}let q=f(O);b.subscribe(R=>{let F=q[R.name];F&&F(R)})}for(let a in t)Object.defineProperty(u,a,{value:E(()=>u()[a])});for(let[a,p]of Object.entries(d(O)))Object.defineProperty(u,a,{value:E(p)});for(let[a,p]of Object.entries(s(O)))Object.defineProperty(O,a,{value:w(b=>{let q=p();q&&b(()=>q())})});r.onDestroy(()=>{P.forEach(a=>a.complete())});let L=()=>{J||(J=!0,Z(l,o,i,!0))};return new Proxy(O,{get(a,p,b){return L(),Reflect.get(a,p,b)},apply(a,p,b){return L(),Reflect.apply(a,p,b)}})}function Z(e,r,i,t=!1){for(let n of r)v(n)?S(e,n,i,t):S(e,n(e.asReadonly()),i,t)}function V(e,r,i,t,n,o,c,d){Object.defineProperties(e,{[i]:{value:s=>v(s)?new Promise((f,l)=>{s.pipe(I(t)).subscribe({next:u=>{c.next({name:i,payload:s,value:u,err:void 0}),n.next(u)},error:u=>{c.next({name:i,payload:s,value:void 0,err:u}),n.error(u),l(u)},complete:()=>{n.complete(),f(e())}})}):(d&&d.pipe(I(t)).subscribe({next:f=>{c.next({name:i,payload:s,value:f,err:void 0})},error:f=>{c.next({name:i,payload:s,value:void 0,err:f})}}),new Promise(f=>{r.pipe(Q(1)).subscribe(l=>{f(l)}),n.next(s)}))},[`${i}$`]:{value:n.asObservable()}}),o.push(n)}var ee=(()=>{let r=class r{loadProducts(){let t=localStorage.getItem("products");return K(t?JSON.parse(t):[])}saveProducts(t){localStorage.setItem("products",JSON.stringify(t))}};r.\u0275fac=function(n){return new(n||r)},r.\u0275prov=C({token:r,factory:r.\u0275fac,providedIn:"root"});let e=r;return e})();var Ce=(()=>{let r=class r{constructor(){this._storageService=y(ee),this.initialState={products:[],loaded:!1},this.loadProducts$=this._storageService.loadProducts().pipe(D(t=>({products:t,loaded:!0}))),this.state=_({initialState:this.initialState,sources:[this.loadProducts$],selectors:t=>({count:()=>t().products.reduce((n,o)=>n+o.quantity,0),price:()=>t().products.reduce((n,o)=>n+o.product.price*o.quantity,0)}),actionSources:{add:(t,n)=>n.pipe(D(o=>this.add(t,o))),remove:(t,n)=>n.pipe(D(o=>this.remove(t,o))),udpate:(t,n)=>n.pipe(D(o=>this.update(t,o)))},effects:t=>({load:()=>{t().loaded&&this._storageService.saveProducts(t().products)}})})}add(t,n){let o=t().products.find(c=>c.product.id===n.product.id);return o?(o.quantity+=1,{products:[...t().products]}):{products:[...t().products,$(m({},n),{quantity:1})]}}remove(t,n){return{products:t().products.filter(o=>o.product.id!==n)}}update(t,n){return{products:t().products.map(c=>c.product.id===n.product.id?$(m({},c),{quantity:n.quantity}):c)}}};r.\u0275fac=function(n){return new(n||r)},r.\u0275prov=C({token:r,factory:r.\u0275fac,providedIn:"root"});let e=r;return e})();export{_ as a,Ce as b};
